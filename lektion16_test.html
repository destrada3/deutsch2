<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lektion 16: Im Hotel</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
  background:#f1faee;color:#1d3557;
  max-width:900px;margin:0 auto;padding:20px;padding-top:75px;line-height:1.6;
}
header{
  position:fixed;top:0;left:0;width:100%;background:#fff;
  box-shadow:0 2px 10px rgba(0,0,0,.1);z-index:1000;
  display:flex;justify-content:space-around;align-items:center;
  padding:10px 0;font-weight:700;font-size:.9em;
}
.badge{padding:5px 14px;border-radius:20px;font-size:.85em}
.badge-try{background:#e9ecef;color:#005f73}
.badge-focus{background:#ffe3e3;color:#ae2012}
h1{text-align:center;color:#005f73;margin:0 0 4px}
.sub{text-align:center;color:#666;margin:0 0 28px;font-size:.95em}
section{
  background:#fff;border-radius:8px;box-shadow:0 4px 6px rgba(0,0,0,.05);
  padding:24px;margin-bottom:24px;border-top:4px solid #0a9396;
}
section h2{
  font-size:1.15em;color:#005f73;border-bottom:1px solid #eee;
  padding-bottom:8px;margin-bottom:14px;
}
.hint{font-style:italic;color:#555;display:block;margin-bottom:12px}
.bank{
  background:#e9ecef;padding:10px;border-radius:5px;margin-bottom:14px;
  font-family:monospace;text-align:center;color:#005f73;
}
.row{margin-bottom:11px;line-height:2.1}
input[type="text"]{
  border:1px solid #ccc;border-radius:4px;padding:5px 8px;
  font-size:1rem;color:#333;background:#fafafa;
  transition:border-color .3s,background .3s;
}
input[type="text"]:focus{
  border-color:#0a9396;background:#fff;outline:none;
  box-shadow:0 0 0 3px rgba(10,147,150,.12);
}
input[type="text"].ok{border-color:#27ae60!important;background:#e8f5e9!important}
input[type="text"].no{border-color:#ae2012!important;background:#ffebee!important}
.scramble{
  background:#333;color:#fff;padding:2px 6px;border-radius:3px;
  font-family:monospace;letter-spacing:1px;font-size:.88em;margin-right:4px;
}
.fb{display:inline;margin-left:4px;font-weight:700;font-size:1.05em}
.fb.ok{color:#27ae60}
.fb.no{color:#ae2012}
.mc{display:inline-flex;gap:14px;margin-left:10px;vertical-align:middle;flex-wrap:wrap}
.mc label{cursor:pointer;padding:2px 8px;border-radius:4px}
.mc label:hover{background:#f1f1f1}
.actions{
  text-align:center;margin:36px 0;
  display:flex;justify-content:center;gap:18px;flex-wrap:wrap;
}
button{
  padding:12px 28px;font-size:1.05em;font-weight:700;
  border:none;border-radius:50px;cursor:pointer;transition:transform .1s;
}
button:active{transform:scale(.97)}
.btn-go{background:#0a9396;color:#fff;box-shadow:0 4px 10px rgba(10,147,150,.3)}
.btn-re{background:#6c757d;color:#fff}
.btn-down{background:#e76f51;color:#fff;box-shadow:0 4px 10px rgba(231,111,81,.3)}
#results{
  background:#fff;border-radius:8px;padding:24px;margin:24px 0;
  box-shadow:0 4px 6px rgba(0,0,0,.05);border-top:4px solid #0a9396;
  display:none;
}
#results h2{color:#005f73;margin-bottom:16px}
.result-box{background:#f8f9fa;padding:16px;border-radius:6px;margin:12px 0}
.verify-code{
  font-size:1.8em;font-weight:700;color:#005f73;
  font-family:monospace;letter-spacing:3px;text-align:center;
  background:#e9ecef;padding:16px;border-radius:8px;margin:16px 0;
}
</style>
</head>
<body>

<header>
  <span class="badge badge-try">Versuch: <span id="vc">0</span></span>
  <span>Lektion 16 Test</span>
  <span class="badge badge-focus">Fokus-Verlust: <span id="fc">0</span></span>
</header>

<h1>Im Hotel</h1>
<p class="sub">Grammatik, Wortschatz und Kommunikation</p>

<!-- 1 -->
<section>
<h2>1. Wortsalat</h2>
<span class="hint">Ordnen Sie die Buchstaben und ergÃ¤nzen Sie.</span>
<p class="row">Das Hotel hat leider keinen <span class="scramble">ALGALENMIAK</span> <input type="text" data-a="klimaanlage" placeholder="..."><span class="fb"></span></p>
<p class="row">(a) Im Erdgeschoss gibt es einen <span class="scramble">FUGAZU</span> <input type="text" data-a="aufzug"><span class="fb"></span></p>
<p class="row">(b) und keine <span class="scramble">DEBTGVIRENTURNENIN</span> <input type="text" data-a="internetverbindung" style="width:200px"><span class="fb"></span></p>
<p class="row">(c) Jedes Zimmer hat einen <span class="scramble">RENFEHESR</span> <input type="text" data-a="fernseher"><span class="fb"></span></p>
<p class="row">(d) In jedem Bad gibt es eine <span class="scramble">SHEDUC</span> <input type="text" data-a="dusche"><span class="fb"></span></p>
</section>

<!-- 2 -->
<section>
<h2>2. Gegenteile &amp; Adjektive</h2>
<span class="hint">ErgÃ¤nzen Sie das fehlende Wort.</span>
<p class="row">a) Das Radio funktioniert nicht, es ist <strong>k</strong><input type="text" data-a="kaputt" style="width:80px"><span class="fb"></span></p>
<p class="row">b) Er kommt immer zu spÃ¤t, er ist nie <strong>p</strong><input type="text" data-a="pÃ¼nktlich" style="width:100px"><span class="fb"></span></p>
<p class="row">c) Der Deutschkurs ist nicht langweilig, er ist <strong>l</strong><input type="text" data-a="lustig" style="width:80px"><span class="fb"></span></p>
<p class="row">d) Heute ist es nicht heiÃŸ, es ist <strong>k</strong><input type="text" data-a="kalt" style="width:60px"><span class="fb"></span></p>
</section>

<!-- 3 -->
<section>
<h2>3. PrÃ¤positionen</h2>
<span class="hint">ErgÃ¤nzen Sie: <b>fÃ¼r, vor, nach, in</b>.</span>
<p class="row">1. Wann bist du fertig? â€” <input type="text" data-a="in" style="width:50px"><span class="fb"></span> einem Jahr.</p>
<p class="row">2. Was machst du <input type="text" data-a="nach" style="width:60px"><span class="fb"></span> der Ausbildung?</p>
<p class="row">3. Ich gehe <input type="text" data-a="fÃ¼r" style="width:50px"><span class="fb"></span> zwei Jahre nach London.</p>
<p class="row">4. Warst du schon in England? â€” Ja, <input type="text" data-a="vor" style="width:50px"><span class="fb"></span> fÃ¼nf Jahren.</p>
<p class="row">5. <input type="text" data-a="vor" style="width:50px"><span class="fb"></span> sechs Monaten habe ich gut Englisch gesprochen.</p>
</section>

<!-- 4 -->
<section>
<h2>4. Grammatik</h2>
<span class="hint">Kreuzen Sie an: Was ist richtig?</span>
<p class="row">a) Die U-Bahn kommt in ... Minute.
  <span class="mc">
    <label><input type="radio" name="q4a" value="einer"> einer</label>
    <label><input type="radio" name="q4a" value="einen"> einen</label>
    <label><input type="radio" name="q4a" value="einem"> einem</label>
  </span><span class="fb" id="f4a"></span>
</p>
<p class="row">b) Nach ... Deutschkurs fÃ¤hrt Isabella.
  <span class="mc">
    <label><input type="radio" name="q4b" value="das"> das</label>
    <label><input type="radio" name="q4b" value="der"> der</label>
    <label><input type="radio" name="q4b" value="dem"> dem</label>
  </span><span class="fb" id="f4b"></span>
</p>
<p class="row">c) Yakub ist vor ... Jahr gekommen.
  <span class="mc">
    <label><input type="radio" name="q4c" value="einer"> einer</label>
    <label><input type="radio" name="q4c" value="einen"> einen</label>
    <label><input type="radio" name="q4c" value="einem"> einem</label>
  </span><span class="fb" id="f4c"></span>
</p>
<p class="row">d) Sie braucht das Auto nur fÃ¼r ... Tag.
  <span class="mc">
    <label><input type="radio" name="q4d" value="ein"> ein</label>
    <label><input type="radio" name="q4d" value="einen"> einen</label>
    <label><input type="radio" name="q4d" value="eine"> eine</label>
  </span><span class="fb" id="f4d"></span>
</p>
</section>

<!-- 5 -->
<section>
<h2>5. Kommunikation</h2>
<div class="bank">Das ist | Was kann | Es gibt | Ich kÃ¼mmere | Das tut</div>
<span class="hint">ErgÃ¤nzen Sie das GesprÃ¤ch.</span>
<p class="row">Rezeption: Ja gern. (1) <input type="text" data-a="was kann"><span class="fb"></span> ich fÃ¼r Sie tun?</p>
<p class="row">Gast: (2) <input type="text" data-a="es gibt"><span class="fb"></span> keine Seife in der Dusche.</p>
<p class="row">Rezeption: Wie dumm! (3) <input type="text" data-a="das tut"><span class="fb"></span> mir leid.</p>
<p class="row">Rezeption: (4) <input type="text" data-a="ich kÃ¼mmere"><span class="fb"></span> mich sofort darum.</p>
<p class="row">Gast: (5) <input type="text" data-a="das ist"><span class="fb"></span> sehr nett.</p>
</section>

<div class="actions">
  <button class="btn-re" id="btnReset">Neu starten</button>
  <button class="btn-go" id="btnCheck">PrÃ¼fen (Corregir)</button>
</div>

<div id="results">
  <h2>âœ… Ergebnis / Resultado</h2>
  <div class="result-box">
    <strong>Punktzahl:</strong> <span id="score">0</span> / <span id="total">0</span> 
    (<span id="percent">0</span>%)
  </div>
  <div class="result-box">
    <strong>CÃ³digo de VerificaciÃ³n:</strong>
    <div class="verify-code" id="verifyCode">000-00000-0</div>
    <small style="color:#666;display:block;text-align:center">
      (Toma captura de pantalla de este cÃ³digo)
    </small>
  </div>
  <div class="actions">
    <button class="btn-down" id="btnDownload">ğŸ“¥ Descargar Comprobante</button>
  </div>
</div>

<script>
(function(){
  "use strict";

  var focusN=0, tryN=0;
  var startTime=Date.now();
  var pasteCount=0, backspaceCount=0, totalKeys=0;
  var answerTimes=[];
  var fillOrder=[];

  /* --- Anti-trampas tracking --- */
  document.addEventListener("visibilitychange",function(){
    if(document.hidden){
      focusN++;
      var e=document.getElementById("fc");
      e.textContent=String(focusN);
      e.parentNode.style.background="#ffcccc";
    }
  });

  document.addEventListener("paste",function(e){
    if(e.target.tagName==="INPUT"){
      pasteCount++;
    }
  });

  document.addEventListener("keydown",function(e){
    if(e.target.tagName==="INPUT"){
      totalKeys++;
      if(e.key==="Backspace"||e.key==="Delete"){
        backspaceCount++;
      }
    }
  });

  var inputs=document.querySelectorAll("input[type='text']");
  inputs.forEach(function(inp,idx){
    var inputStartTime=null;
    inp.addEventListener("focus",function(){
      inputStartTime=Date.now();
    });
    inp.addEventListener("blur",function(){
      if(inputStartTime&&inp.value.trim()!==""){
        var elapsed=Date.now()-inputStartTime;
        answerTimes.push(elapsed);
        fillOrder.push(idx);
      }
    });
  });

  /* --- Utils --- */
  function norm(s){
    return(s||"").trim().toLowerCase()
      .replace(/[.,;:?!\u0022\u0027\u0060\u00B4\u2018\u2019\u201C\u201D]/g,"")
      .replace(/\s+/g," ");
  }
  function expand(s){
    return s.replace(/\u00FC/g,"ue").replace(/\u00E4/g,"ae")
            .replace(/\u00F6/g,"oe").replace(/\u00DF/g,"ss");
  }
  function eq(u,c){
    var a=norm(u),b=norm(c);
    return a===b || expand(a)===expand(b);
  }
  function getFb(el){
    var n=el.nextElementSibling,i=3;
    while(n&&i--){if(n.classList.contains("fb"))return n;n=n.nextElementSibling;}
    return null;
  }

  var mc={"q4a":"einer","q4b":"dem","q4c":"einem","q4d":"einen"};

  /* --- Calcular puntuaciÃ³n de integridad --- */
  function calculateIntegrity(){
    var score=100;
    var flags=[];

    // 1. Paste events
    if(pasteCount>5){
      score-=25;
      flags.push("excessive_paste");
    }

    // 2. Focus changes
    if(focusN>10){
      score-=15;
      flags.push("frequent_tab_switching");
    }

    // 3. Rapid fill pattern
    var rapidFills=answerTimes.filter(function(t){return t<500;}).length;
    if(rapidFills>8){
      score-=30;
      flags.push("rapid_fill_pattern");
    }

    // 4. Unrealistic speed
    if(answerTimes.length>10){
      var avg=answerTimes.reduce(function(a,b){return a+b;},0)/answerTimes.length;
      if(avg<2000){
        score-=25;
        flags.push("unrealistic_speed");
      }
    }

    // 5. No corrections
    if(totalKeys>0){
      var backspaceRatio=backspaceCount/totalKeys;
      if(backspaceRatio<0.02){
        score-=20;
        flags.push("no_corrections");
      }
    }

    // 6. Perfect sequence
    if(fillOrder.length>15){
      var isSequential=true;
      for(var i=1;i<fillOrder.length;i++){
        if(fillOrder[i]!==fillOrder[i-1]+1){
          isSequential=false;
          break;
        }
      }
      if(isSequential){
        score-=15;
        flags.push("perfect_sequence");
      }
    }

    score=Math.max(0,Math.min(100,score));
    var riskLevel=score>=70?"low":(score>=40?"medium":"high");
    var riskCode=score>=70?0:(score>=40?1:2);

    return{
      score:score,
      level:riskLevel,
      riskCode:riskCode,
      flags:flags
    };
  }

  /* --- Generar cÃ³digo de verificaciÃ³n --- */
  function generateVerifyCode(integrity,totalTime,tryCount){
    var timestamp=Date.now();
    var last4=String(timestamp).slice(-4);
    var scoreStr=String(integrity.score).padStart(3,"0");
    var code=scoreStr+"-"+integrity.riskCode+last4+"-"+tryCount;
    return code;
  }

  /* --- Generar archivo de comprobante --- */
  function generateReceipt(ok,tot,integrity,totalTime,verifyCode){
    var now=new Date();
    var dateStr=now.toLocaleDateString("es-MX");
    var timeStr=now.toLocaleTimeString("es-MX");
    var avgTime=answerTimes.length>0?(answerTimes.reduce(function(a,b){return a+b;},0)/answerTimes.length):0;

    var txt="";
    txt+="â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n";
    txt+="        COMPROBANTE DE EVALUACIÃ“N - LEKTION 16: IM HOTEL       \n";
    txt+="â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n";
    txt+="Fecha: "+dateStr+"\n";
    txt+="Hora: "+timeStr+"\n";
    txt+="Ejercicio: Lektion 16 - Im Hotel (Grammatik & Wortschatz)\n\n";
    txt+="â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n";
    txt+="                         RESULTADOS ACADÃ‰MICOS                  \n";
    txt+="â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n";
    txt+="Respuestas Correctas:         "+ok+" / "+tot+"\n";
    txt+="Porcentaje:                   "+Math.round(ok/tot*100)+"%\n";
    txt+="NÃºmero de Intentos:           "+tryN+"\n";
    txt+="Tiempo Total:                 "+Math.round(totalTime/1000)+" segundos\n\n";
    txt+="â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n";
    txt+="              CÃ“DIGO DE VERIFICACIÃ“N (VISIBLE)                  \n";
    txt+="â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n";
    txt+="    "+verifyCode+"\n\n";
    txt+="FORMATO: [PUNTUACIÃ“N]-[RIESGO+TIMESTAMP]-[INTENTOS]\n";
    txt+="  â€¢ Primeros 3 dÃ­gitos: PuntuaciÃ³n de integridad (000-100)\n";
    txt+="  â€¢ Cuarto dÃ­gito: Nivel de riesgo (0=bajo, 1=medio, 2=alto)\n";
    txt+="  â€¢ Siguientes 4 dÃ­gitos: Timestamp de verificaciÃ³n\n";
    txt+="  â€¢ Ãšltimo dÃ­gito: NÃºmero de intentos\n\n";
    txt+="â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n";
    txt+="              DATOS DE INTEGRIDAD (USO DOCENTE)                 \n";
    txt+="â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n";
    txt+="PuntuaciÃ³n de Integridad:     "+integrity.score+"/100\n";
    txt+="Nivel de Riesgo:              "+integrity.level+"\n";
    txt+="Tiempo Total:                 "+Math.round(totalTime/1000)+" segundos\n";
    txt+="Tiempo Promedio/Pregunta:     "+Math.round(avgTime)+" ms\n";
    txt+="Eventos de Pegar:             "+pasteCount+"\n";
    txt+="Cambios de Ventana:           "+focusN+"\n";
    txt+="Teclas Backspace:             "+backspaceCount+" / "+totalKeys+" total\n";
    txt+="Respuestas RÃ¡pidas (<500ms):  "+answerTimes.filter(function(t){return t<500;}).length+"\n\n";
    txt+="Indicadores detectados:       "+(integrity.flags.length>0?integrity.flags.join(", "):"ninguno")+"\n\n";
    txt+="â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n";
    txt+="                    INTERPRETACIÃ“N DEL CÃ“DIGO                   \n";
    txt+="â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n";
    txt+="DecodificaciÃ³n del cÃ³digo: "+verifyCode+"\n\n";
    txt+="  â€¢ PuntuaciÃ³n: "+integrity.score+"/100 puntos\n";
    txt+="  â€¢ Nivel: "+integrity.level.toUpperCase()+"\n";
    if(integrity.score>=70){
      txt+="  â€¢ EvaluaciÃ³n: âœ… RIESGO BAJO - Comportamiento normal\n";
    }else if(integrity.score>=40){
      txt+="  â€¢ EvaluaciÃ³n: âš ï¸ RIESGO MEDIO - RevisiÃ³n recomendada\n";
    }else{
      txt+="  â€¢ EvaluaciÃ³n: ğŸš¨ RIESGO ALTO - Requiere verificaciÃ³n\n";
    }
    txt+="  â€¢ NÃºmero de intentos: "+tryN+"\n\n";
    txt+="â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n";
    txt+="                    INSTRUCCIONES PARA EL ESTUDIANTE            \n";
    txt+="â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n";
    txt+="1. Toma una CAPTURA DE PANTALLA del panel de resultados\n";
    txt+="   (debe verse el CÃ³digo de VerificaciÃ³n completo)\n\n";
    txt+="2. Descarga este archivo .txt\n\n";
    txt+="3. Entrega AMBOS archivos (screenshot + .txt) a tu profesor\n\n";
    txt+="âš ï¸  IMPORTANTE: El cÃ³digo del screenshot debe coincidir con\n";
    txt+"    los datos de este archivo para validar autenticidad.\n\n";
    txt+="â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n";
    txt+="           Preparatoria TecMilenio - Curso de AlemÃ¡n            \n";
    txt+="                          2026                                   \n";
    txt+="â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n";

    return txt;
  }

  /* --- Corregir --- */
  document.getElementById("btnCheck").addEventListener("click",function(){
    var ok=0,tot=0;
    var inputs=document.querySelectorAll("input[type='text']");
    for(var i=0;i<inputs.length;i++){
      tot++;
      var inp=inputs[i], val=inp.value, ans=inp.getAttribute("data-a")||"";
      var sp=getFb(inp);
      inp.classList.remove("ok","no");
      if(sp){sp.className="fb";sp.textContent="";}
      var t=norm(val);
      if(t!==""&&eq(val,ans)){
        inp.classList.add("ok");
        if(sp){sp.classList.add("ok");sp.textContent="\u2713";}
        ok++;
      }else if(t!==""){
        inp.classList.add("no");
        if(sp){sp.classList.add("no");sp.textContent="\u2717";}
      }
    }
    for(var g in mc){
      if(!mc.hasOwnProperty(g))continue;
      tot++;
      var sel=document.querySelector("input[name='"+g+"']:checked");
      var fe=document.getElementById("f"+g.slice(1));
      if(fe){fe.className="fb";fe.textContent="";}
      if(sel){
        if(sel.value===mc[g]){
          ok++;
          if(fe){fe.classList.add("ok");fe.textContent="\u2713 Richtig";}
        }else{
          if(fe){fe.classList.add("no");fe.textContent="\u2717 Falsch";}
        }
      }
    }

    tryN++;
    document.getElementById("vc").textContent=String(tryN);

    var totalTime=Date.now()-startTime;
    var integrity=calculateIntegrity();
    var verifyCode=generateVerifyCode(integrity,totalTime,tryN);

    document.getElementById("score").textContent=ok;
    document.getElementById("total").textContent=tot;
    document.getElementById("percent").textContent=Math.round(ok/tot*100);
    document.getElementById("verifyCode").textContent=verifyCode;
    document.getElementById("results").style.display="block";

    var receiptText=generateReceipt(ok,tot,integrity,totalTime,verifyCode);
    document.getElementById("btnDownload").onclick=function(){
      var blob=new Blob([receiptText],{type:"text/plain;charset=utf-8"});
      var url=URL.createObjectURL(blob);
      var a=document.createElement("a");
      a.href=url;
      a.download="Lektion16_Comprobante_"+Date.now()+".txt";
      a.click();
      URL.revokeObjectURL(url);
    };

    document.getElementById("results").scrollIntoView({behavior:"smooth"});
  });

  /* --- Reiniciar --- */
  document.getElementById("btnReset").addEventListener("click",function(){
    if(!confirm("Wirklich neu starten?"))return;
    var inputs=document.querySelectorAll("input[type='text']");
    for(var i=0;i<inputs.length;i++){
      inputs[i].value="";inputs[i].classList.remove("ok","no");
      var sp=getFb(inputs[i]);
      if(sp){sp.className="fb";sp.textContent="";}
    }
    var radios=document.querySelectorAll("input[type='radio']");
    for(var j=0;j<radios.length;j++)radios[j].checked=false;
    for(var g in mc){
      if(!mc.hasOwnProperty(g))continue;
      var fe=document.getElementById("f"+g.slice(1));
      if(fe){fe.className="fb";fe.textContent="";}
    }
    document.getElementById("results").style.display="none";
    
    // Reset tracking
    startTime=Date.now();
    pasteCount=0;
    backspaceCount=0;
    totalKeys=0;
    answerTimes=[];
    fillOrder=[];
    
    window.scrollTo(0,0);
  });

})();
</script>
</body>
</html>
